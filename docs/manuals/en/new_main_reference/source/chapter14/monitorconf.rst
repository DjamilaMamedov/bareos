.. ATTENTION do not edit this file manually.
   It was automatically converted from the corresponding .tex file

.. _section-MonitorConfig:

Monitor Configuration
=====================

:index:`[TAG=Monitor Configuration] <single: Monitor Configuration>` :index:`[TAG=Configuration->Monitor] <pair: Configuration; Monitor>`

The Monitor configuration file is a stripped down version of the Director configuration file, mixed with a Console configuration file. It simply contains the information necessary to contact Directors, Clients, and Storage daemons you want to monitor.

For a general discussion of configuration file and resources including the data types recognized by Bareos, please see the :ref:`Configuration <ConfigureChapter>` chapter of this manual.

The following Monitor Resource definition must be defined:

-  :ref:`Monitor <MonitorResource>` – to define the Monitor’s name used to connect to all the daemons and the password used to connect to the Directors. Note, you must not define more than one Monitor resource in the Monitor configuration file.

-  At least one :ref:`Client <ClientResource1>`, :ref:`Storage <StorageResource1>` or :ref:`Director <DirectorResource2>` resource, to define the daemons to monitor.

.. _MonitorResource:

Monitor Resource
----------------

:index:`[TAG=Monitor Resource] <single: Monitor Resource>` :index:`[TAG=Resource->Monitor] <pair: Resource; Monitor>`

The Monitor resource defines the attributes of the Monitor running on the network. The parameters you define here must be configured as a Director resource in Clients and Storages configuration files, and as a Console resource in Directors configuration files.

============================================================================================================================ ============================================================================================================================ ============================================================================================================================ ============================================================================================================================
:strong:`:strong:`configuration directive name                                                    ``  :strong:`:strong:`type of data                                                                    ``  :strong:`:strong:`default value                                                                   ``  :strong:`:strong:`remark                                                                          `` 
============================================================================================================================ ============================================================================================================================ ============================================================================================================================ ============================================================================================================================
.. raw:: latex                                                                                                               = :strong:`String`                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                                                                                                                                                      
   \csgdef{resourceDirectiveDefinedConsoleMonitorDescription}{yes}                                                                                                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                                                                                                                                                      
:config:option:`console/monitor/Description`\                                                                                                                                                                                                                                                                                                                    
.. raw:: latex                                                                                                               = :strong:`Time`                                                                                                     10                                                                                                                          
                                                                                                                                                                                                                                                                                                                                                                                      
   \csgdef{resourceDirectiveDefinedConsoleMonitorDir Connect Timeout}{yes}                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                      
:config:option:`console/monitor/DirConnectTimeout`\                                                                                                                                                                                                                                                                                                            
.. raw:: latex                                                                                                               = :strong:`Time`                                                                                                     10                                                                                                                          
                                                                                                                                                                                                                                                                                                                                                                                      
   \csgdef{resourceDirectiveDefinedConsoleMonitorFD Connect Timeout}{yes}                                                                                                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                                                                                                                                                      
:config:option:`console/monitor/FdConnectTimeout`\                                                                                                                                                                                                                                                                                                             
.. raw:: latex                                                                                                               **= :strong:`Name`**                                                                                                                                                                                                                              **required**
                                                                                                                                                                                                                                                                                                                                                                                      
   \csgdef{resourceDirectiveDefinedConsoleMonitorName}{yes}                                                                                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                                                                                                                                                      
**:config:option:`console/monitor/Name`\ **                                                                                                                                                                                                                                                                                                                      
.. raw:: latex                                                                                                               **= :strong:`Md5password`**                                                                                                                                                                                                                       **required**
                                                                                                                                                                                                                                                                                                                                                                                      
   \csgdef{resourceDirectiveDefinedConsoleMonitorPassword}{yes}                                                                                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                                                                                                                                      
**:config:option:`console/monitor/Password`\ **                                                                                                                                                                                                                                                                                                                  
.. raw:: latex                                                                                                               = :strong:`Time`                                                                                                     60                                                                                                                          
                                                                                                                                                                                                                                                                                                                                                                                      
   \csgdef{resourceDirectiveDefinedConsoleMonitorRefresh Interval}{yes}                                                                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                                                                                                                                                      
:config:option:`console/monitor/RefreshInterval`\                                                                                                                                                                                                                                                                                                               
.. raw:: latex                                                                                                               = :strong:`Boolean`                                                                                                  no                                                                                                                          
                                                                                                                                                                                                                                                                                                                                                                                      
   \csgdef{resourceDirectiveDefinedConsoleMonitorRequire SSL}{yes}                                                                                                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                                                                                                                                                      
:config:option:`console/monitor/RequireSsl`\                                                                                                                                                                                                                                                                                                                    
.. raw:: latex                                                                                                               = :strong:`Time`                                                                                                     10                                                                                                                          
                                                                                                                                                                                                                                                                                                                                                                                      
   \csgdef{resourceDirectiveDefinedConsoleMonitorSD Connect Timeout}{yes}                                                                                                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                                                                                                                                                      
:config:option:`console/monitor/SdConnectTimeout`\                                                                                                                                                                                                                                                                                                             
============================================================================================================================ ============================================================================================================================ ============================================================================================================================ ============================================================================================================================

















\begin{description}

   \resourceDirective{Console}{Monitor}{Description}{\dt{String}}{}{}{}{}

   \resourceDirective{Console}{Monitor}{Dir Connect Timeout}{\dt{Time}}{}{10}{}{}

   \resourceDirective{Console}{Monitor}{FD Connect Timeout}{\dt{Time}}{}{10}{}{}

   \resourceDirective{Console}{Monitor}{Name}{\dt{Name}}{required}{}{}{}

   \resourceDirective{Console}{Monitor}{Password}{\dt{Md5password}}{required}{}{}{}

   \resourceDirective{Console}{Monitor}{Refresh Interval}{\dt{Time}}{}{60}{}{}

   \resourceDirective{Console}{Monitor}{Require SSL}{\dt{Boolean}}{}{no}{}{}

   \resourceDirective{Console}{Monitor}{SD Connect Timeout}{\dt{Time}}{}{10}{}{}

   \end{description}

.. _DirectorResource2:

Director Resource
-----------------

:index:`[TAG=Director Resource] <single: Director Resource>` :index:`[TAG=Resource->Director] <pair: Resource; Director>`

The Director resource defines the attributes of the Directors that are monitored by this Monitor.

As you are not permitted to define a Password in this resource, to avoid obtaining full Director privileges, you must create a Console resource in the :ref:`Director's configuration <DirectorChapter>` file, using the Console Name and Password defined in the Monitor resource. To avoid security problems, you should configure this Console resource to allow access to no other daemons, and permit the use of only two commands: status and .status (see below for an example).

You may have multiple Director resource specifications in a single Monitor configuration file.

============================================================================================================================ ============================================================================================================================ ============================================================================================================================ ============================================================================================================================
:strong:`:strong:`configuration directive name                                                    ``  :strong:`:strong:`type of data                                                                    ``  :strong:`:strong:`default value                                                                   ``  :strong:`:strong:`remark                                                                          `` 
============================================================================================================================ ============================================================================================================================ ============================================================================================================================ ============================================================================================================================
.. raw:: latex                                                                                                               **= :strong:`String`**                                                                                                                                                                                                                            **required**
                                                                                                                                                                                                                                                                                                                                                                                      
   \csgdef{resourceDirectiveDefinedConsoleDirectorAddress}{yes}                                                                                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                                                                                                                                      
**:config:option:`console/director/Address`\ **                                                                                                                                                                                                                                                                                                                  
.. raw:: latex                                                                                                               = :strong:`String`                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                                                                                                                                                      
   \csgdef{resourceDirectiveDefinedConsoleDirectorDescription}{yes}                                                                                                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                                                                                                                                                      
:config:option:`console/director/Description`\                                                                                                                                                                                                                                                                                                                   
.. raw:: latex                                                                                                               = :strong:`Pint32`                                                                                                   9101                                                                                                                        
                                                                                                                                                                                                                                                                                                                                                                                      
   \csgdef{resourceDirectiveDefinedConsoleDirectorDir Port}{yes}                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                      
:config:option:`console/director/DirPort`\                                                                                                                                                                                                                                                                                                                      
.. raw:: latex                                                                                                               = :strong:`Boolean`                                                                                                  no                                                                                                                          
                                                                                                                                                                                                                                                                                                                                                                                      
   \csgdef{resourceDirectiveDefinedConsoleDirectorEnable SSL}{yes}                                                                                                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                                                                                                                                                      
:config:option:`console/director/EnableSsl`\                                                                                                                                                                                                                                                                                                                    
.. raw:: latex                                                                                                               **= :strong:`Name`**                                                                                                                                                                                                                              **required**
                                                                                                                                                                                                                                                                                                                                                                                      
   \csgdef{resourceDirectiveDefinedConsoleDirectorName}{yes}                                                                                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                                                                                                                                                      
**:config:option:`console/director/Name`\ **                                                                                                                                                                                                                                                                                                                     
============================================================================================================================ ============================================================================================================================ ============================================================================================================================ ============================================================================================================================











\begin{description}

   \resourceDirective{Console}{Director}{Address}{\dt{String}}{required}{}{}{}

   \resourceDirective{Console}{Director}{Description}{\dt{String}}{}{}{}{}

   \resourceDirective{Console}{Director}{Dir Port}{\dt{Pint32}}{}{9101}{}{}

   \resourceDirective{Console}{Director}{Enable SSL}{\dt{Boolean}}{}{no}{}{}

   \resourceDirective{Console}{Director}{Name}{\dt{Name}}{required}{}{}{}

   \end{description}

.. _ClientResource1:

Client Resource
---------------

:index:`[TAG=Resource->Client] <pair: Resource; Client>` :index:`[TAG=Client Resource] <single: Client Resource>`

The Client resource defines the attributes of the Clients that are monitored by this Monitor.

You must create a Director resource in the :ref:`Client's configuration <FiledConfChapter>` file, using the Director Name defined in the Monitor resource. To avoid security problems, you should set the Monitor directive to Yes in this Director resource.

You may have multiple Director resource specifications in a single Monitor configuration file.

============================================================================================================================ ============================================================================================================================ ============================================================================================================================ ============================================================================================================================
:strong:`:strong:`configuration directive name                                                    ``  :strong:`:strong:`type of data                                                                    ``  :strong:`:strong:`default value                                                                   ``  :strong:`:strong:`remark                                                                          `` 
============================================================================================================================ ============================================================================================================================ ============================================================================================================================ ============================================================================================================================
.. raw:: latex                                                                                                               **= :strong:`String`**                                                                                                                                                                                                                            **required**
                                                                                                                                                                                                                                                                                                                                                                                      
   \csgdef{resourceDirectiveDefinedConsoleClientAddress}{yes}                                                                                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                                                                                                                                                      
**:config:option:`console/client/Address`\ **                                                                                                                                                                                                                                                                                                                    
.. raw:: latex                                                                                                               = :strong:`String`                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                                                                                                                                                      
   \csgdef{resourceDirectiveDefinedConsoleClientDescription}{yes}                                                                                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                                                                                                                                                      
:config:option:`console/client/Description`\                                                                                                                                                                                                                                                                                                                     
.. raw:: latex                                                                                                               = :strong:`Boolean`                                                                                                  no                                                                                                                          
                                                                                                                                                                                                                                                                                                                                                                                      
   \csgdef{resourceDirectiveDefinedConsoleClientEnable SSL}{yes}                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                      
:config:option:`console/client/EnableSsl`\                                                                                                                                                                                                                                                                                                                      
.. raw:: latex                                                                                                               = :strong:`Pint32`                                                                                                   9102                                                                                                                        
                                                                                                                                                                                                                                                                                                                                                                                      
   \csgdef{resourceDirectiveDefinedConsoleClientFD Port}{yes}                                                                                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                                                                                                                                                      
:config:option:`console/client/FdPort`\                                                                                                                                                                                                                                                                                                                         
.. raw:: latex                                                                                                               **= :strong:`Name`**                                                                                                                                                                                                                              **required**
                                                                                                                                                                                                                                                                                                                                                                                      
   \csgdef{resourceDirectiveDefinedConsoleClientName}{yes}                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                      
**:config:option:`console/client/Name`\ **                                                                                                                                                                                                                                                                                                                       
.. raw:: latex                                                                                                               **= :strong:`Md5password`**                                                                                                                                                                                                                       **required**
                                                                                                                                                                                                                                                                                                                                                                                      
   \csgdef{resourceDirectiveDefinedConsoleClientPassword}{yes}                                                                                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                                                                                                                                                      
**:config:option:`console/client/Password`\ **                                                                                                                                                                                                                                                                                                                   
============================================================================================================================ ============================================================================================================================ ============================================================================================================================ ============================================================================================================================













\begin{description}

   \resourceDirective{Console}{Client}{Address}{\dt{String}}{required}{}{}{}

   \resourceDirective{Console}{Client}{Description}{\dt{String}}{}{}{}{}

   \resourceDirective{Console}{Client}{Enable SSL}{\dt{Boolean}}{}{no}{}{}

   \resourceDirective{Console}{Client}{FD Port}{\dt{Pint32}}{}{9102}{}{}

   \resourceDirective{Console}{Client}{Name}{\dt{Name}}{required}{}{}{}

   \resourceDirective{Console}{Client}{Password}{\dt{Md5password}}{required}{}{}{}

   \end{description}

.. _StorageResource1:

Storage Resource
----------------

:index:`[TAG=Resource->Storage] <pair: Resource; Storage>` :index:`[TAG=Storage Resource] <single: Storage Resource>`

The Storage resource defines the attributes of the Storages that are monitored by this Monitor.

You must create a Director resource in the :ref:`Storage's configuration <StoredConfChapter>` file, using the Director Name defined in the Monitor resource. To avoid security problems, you should set the Monitor directive to Yes in this Director resource.

You may have multiple Director resource specifications in a single Monitor configuration file.

============================================================================================================================ ============================================================================================================================ ============================================================================================================================ ============================================================================================================================
:strong:`:strong:`configuration directive name                                                    ``  :strong:`:strong:`type of data                                                                    ``  :strong:`:strong:`default value                                                                   ``  :strong:`:strong:`remark                                                                          `` 
============================================================================================================================ ============================================================================================================================ ============================================================================================================================ ============================================================================================================================
.. raw:: latex                                                                                                               **= :strong:`String`**                                                                                                                                                                                                                            **required**
                                                                                                                                                                                                                                                                                                                                                                                      
   \csgdef{resourceDirectiveDefinedConsoleStorageAddress}{yes}                                                                                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                                                                                                                                                      
**:config:option:`console/storage/Address`\ **                                                                                                                                                                                                                                                                                                                   
.. raw:: latex                                                                                                               = :strong:`String`                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                                                                                                                                                      
   \csgdef{resourceDirectiveDefinedConsoleStorageDescription}{yes}                                                                                                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                                                                                                                                                      
:config:option:`console/storage/Description`\                                                                                                                                                                                                                                                                                                                    
.. raw:: latex                                                                                                               = :strong:`Boolean`                                                                                                  no                                                                                                                          
                                                                                                                                                                                                                                                                                                                                                                                      
   \csgdef{resourceDirectiveDefinedConsoleStorageEnable SSL}{yes}                                                                                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                                                                                                                                                      
:config:option:`console/storage/EnableSsl`\                                                                                                                                                                                                                                                                                                                     
.. raw:: latex                                                                                                               **= :strong:`Name`**                                                                                                                                                                                                                              **required**
                                                                                                                                                                                                                                                                                                                                                                                      
   \csgdef{resourceDirectiveDefinedConsoleStorageName}{yes}                                                                                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                                                                                                                                                      
**:config:option:`console/storage/Name`\ **                                                                                                                                                                                                                                                                                                                      
.. raw:: latex                                                                                                               **= :strong:`Md5password`**                                                                                                                                                                                                                       **required**
                                                                                                                                                                                                                                                                                                                                                                                      
   \csgdef{resourceDirectiveDefinedConsoleStoragePassword}{yes}                                                                                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                                                                                                                                      
**:config:option:`console/storage/Password`\ **                                                                                                                                                                                                                                                                                                                  
.. raw:: latex                                                                                                               = :strong:`String`                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                                                                                                                                                      
   \csgdef{resourceDirectiveDefinedConsoleStorageSD Address}{yes}                                                                                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                                                                                                                                                      
:config:option:`console/storage/SdAddress`\                                                                                                                                                                                                                                                                                                                     
.. raw:: latex                                                                                                               = :strong:`Md5password`                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                                                                                                                                                      
   \csgdef{resourceDirectiveDefinedConsoleStorageSD Password}{yes}                                                                                                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                                                                                                                                                      
:config:option:`console/storage/SdPassword`\                                                                                                                                                                                                                                                                                                                    
.. raw:: latex                                                                                                               = :strong:`Pint32`                                                                                                   9103                                                                                                                        
                                                                                                                                                                                                                                                                                                                                                                                      
   \csgdef{resourceDirectiveDefinedConsoleStorageSD Port}{yes}                                                                                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                                                                                                                                                      
:config:option:`console/storage/SdPort`\                                                                                                                                                                                                                                                                                                                        
============================================================================================================================ ============================================================================================================================ ============================================================================================================================ ============================================================================================================================

















\begin{description}

   \resourceDirective{Console}{Storage}{Address}{\dt{String}}{required}{}{}{}

   \resourceDirective{Console}{Storage}{Description}{\dt{String}}{}{}{}{}

   \resourceDirective{Console}{Storage}{Enable SSL}{\dt{Boolean}}{}{no}{}{}

   \resourceDirective{Console}{Storage}{Name}{\dt{Name}}{required}{}{}{}

   \resourceDirective{Console}{Storage}{Password}{\dt{Md5password}}{required}{}{}{}

   \resourceDirective{Console}{Storage}{SD Address}{\dt{String}}{}{}{}{}

   \resourceDirective{Console}{Storage}{SD Password}{\dt{Md5password}}{}{}{}{}

   \resourceDirective{Console}{Storage}{SD Port}{\dt{Pint32}}{}{9103}{}{}

   \end{description}

Tray Monitor
------------

Tray Monitor Security
~~~~~~~~~~~~~~~~~~~~~

:index:`[TAG=Tray Monitor Security] <single: Tray Monitor Security>` :index:`[TAG=Security->Tray Monitor] <pair: Security; Tray Monitor>`

There is no security problem in relaxing the permissions on tray-monitor.conf as long as FD, SD and DIR are configured properly, so the passwords contained in this file only gives access to the status of the daemons. It could be a security problem if you consider the status information as potentially dangerous (most people consider this as not being dangerous).

| Concerning Director’s configuration:
| In tray-monitor.conf, the password in the Monitor resource must point to a restricted console in bareos-dir.conf (see the documentation). So, if you use this password with bconsole, you’ll only have access to the status of the director (commands status and .status). It could be a security problem if there is a bug in the ACL code of the director.

| Concerning File and Storage Daemons’ configuration:
| In tray-monitor.conf, the Name in the Monitor resource must point to a Director resource in bareos-fd/sd.conf, with the Monitor directive set to Yes (see the documentation). It could be a security problem if there is a bug in the code which check if a command is valid for a Monitor (this is very unlikely as the code is pretty simple).

Example Tray Monitor configuration
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

:index:`[TAG=Tray Monitor->Configuration] <pair: Tray Monitor; Configuration>` :index:`[TAG=Configuration->Tray Monitor] <pair: Configuration; Tray Monitor>`

An example Tray Monitor configuration file might be the following:

.. code-block:: sh
   :caption: Example tray-monitor.conf

   #
   # Bareos Tray Monitor Configuration File
   #
   Monitor {
     Name = rufus-mon        # password for Directors
     Password = "GN0uRo7PTUmlMbqrJ2Gr1p0fk0HQJTxwnFyE4WSST3MWZseR"
     RefreshInterval = 10 seconds
   }

   Client {
     Name = rufus-fd
     Address = rufus
     FDPort = 9102           # password for FileDaemon
     Password = "FYpq4yyI1y562EMS35bA0J0QC0M2L3t5cZObxT3XQxgxppTn"
   }
   Storage {
     Name = rufus-sd
     Address = rufus
     SDPort = 9103           # password for StorageDaemon
     Password = "9usxgc307dMbe7jbD16v0PXlhD64UVasIDD0DH2WAujcDsc6"
   }
   Director {
     Name = rufus-dir
     DIRport = 9101
     address = rufus
   }

Example File daemon’s Director record
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

.. code-block:: sh
   :caption: Example Monitor resource

   #
   # Restricted Director, used by tray-monitor to get the
   #   status of the file daemon
   #
   Director {
     Name = rufus-mon
     Password = "FYpq4yyI1y562EMS35bA0J0QC0M2L3t5cZObxT3XQxgxppTn"
     Monitor = yes
   }

A full example can be found at :ref:`SampleClientConfiguration`.

Example Storage daemon’s Director record
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

.. code-block:: sh
   :caption: Example Monitor resource

   #
   # Restricted Director, used by tray-monitor to get the
   #   status of the storage daemon
   #
   Director {
     Name = rufus-mon
     Password = "9usxgc307dMbe7jbD16v0PXlhD64UVasIDD0DH2WAujcDsc6"
     Monitor = yes
   }

Example Director’s Console record
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

.. code-block:: sh
   :caption: Example Monitor resource

   #
   # Restricted console used by tray-monitor to get the status of the director
   #
   Console {
     Name = Monitor
     Password = "GN0uRo7PTUmlMbqrJ2Gr1p0fk0HQJTxwnFyE4WSST3MWZseR"
     CommandACL = status, .status
   }
